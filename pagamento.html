  <!DOCTYPE html>
  <html lang="pt-BR">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Pagamento - Berserk</title>
      <meta
        name="description"
        content="Finalize o pagamento da sua compra na Berserk Store. Confira o resumo do pedido, escolha tamanho, quantidade e forma de pagamento."
      />
      <link rel="stylesheet" href="css/style.css" />
    </head>
    <body>
      <header class="site-header">
        <div class="container">
          <a
            class="logo"
            href="index.html"
            aria-label="Página inicial Berserk Store"
          >
            <img src="img/Pepeu logo.jpg" alt="pepeu Logo" class="logo-img" />
          </a>
          <nav class="main-nav" aria-label="Navegação principal">
            <ul>
              <li><a href="index.html">Início</a></li>
              <li><a href="produtos.html">Produtos</a></li>
              <li><a href="sobre.html">Sobre</a></li>
              <li><a href="contato.html">Contato</a></li>
            </ul>
          </nav>
        </div>
      </header>

      <main>
        <section class="container checkout" aria-labelledby="titulo-pagamento">
          <h1 id="titulo-pagamento">Pagamento</h1>

          <div class="checkout-grid">
            <div id="resumo" class="summary">
              <h2>Resumo do pedido</h2>
              <div
                class="summary-product"
                style="display: flex; gap: 12px; align-items: flex-start"
              >
                <img
                  id="produto-img"
                  src="img/prod1.jpg"
                  alt="Produto selecionado"
                  style="
                    width: 120px;
                    height: 120px;
                    object-fit: contain;
                    border-radius: 8px;
                    background: var(--bg);
                  "
                />
                <div>
                  <p>
                    <strong>Produto:</strong>
                    <span id="produto-nome-resumo">Produto</span>
                  </p>
                  <p id="produto-desc-resumo" class="muted">
                    Descrição do produto aparecerá aqui.
                  </p>
                </div>
              </div>

              <p><strong>Tamanho:</strong> <span id="resumo-tamanho">M</span></p>
              <p>
                <strong>Quantidade:</strong>
                <span id="resumo-quantidade">1</span>
              </p>
              <p>
                <strong>Total:</strong>
                <span id="resumo-total">R$ 0,00</span>
              </p>
              <p>
                <strong>Forma de pagamento:</strong>
                <span id="resumo-pagamento">Pix</span>
              </p>
            </div>
            <div
              id="feedback"
              class="feedback"
              style="display: none; color: green"
            >
              Resumo atualizado com sucesso!
            </div>

            <form
              id="payForm"
              class="payment"
              action="obrigado.html"
              method="get"
              aria-label="Formulário de pagamento"
            >
              <input type="hidden" name="produto" id="produto" value="" />
              <label for="tamanhoSelect">Tamanho da camisa:</label>
              <select id="tamanhoSelect" name="tamanho" required>
                <option value="P">P</option>
                <option value="M" selected>M</option>
                <option value="G">G</option>
                <option value="GG">GG</option>
              </select>

              <label for="quantidadeInput">Quantidade:</label>
              <input
                type="number"
                id="quantidadeInput"
                name="quantidade"
                min="1"
                value="1"
                required
              />

              <fieldset class="payment-methods-group">
                <legend>Forma de pagamento</legend>
                <label class="payment-method">
                  <input type="radio" name="formaPagamento" value="Pix" checked />
                  <span class="method-title">Pix</span>
                  <span class="method-sub">Pagamento instantâneo, à vista</span>
                </label>
                <label class="payment-method">
                  <input
                    type="radio"
                    name="formaPagamento"
                    value="Cartão de crédito"
                  />
                  <span class="method-title">Cartão de crédito</span>
                  <span class="method-sub">Pague em até 12x</span>
                </label>
                <label class="payment-method">
                  <input type="radio" name="formaPagamento" value="Boleto" />
                  <span class="method-title">Boleto bancário</span>
                  <span class="method-sub">Compensação em até 2 dias úteis</span>
                </label>
              </fieldset>

              <div id="card-fields" class="card-fields">
                <label for="numero-cartao">Número do cartão</label>
                <input
                  type="text"
                  id="numero-cartao"
                  name="numeroCartao"
                  inputmode="numeric"
                  autocomplete="cc-number"
                  placeholder="0000 0000 0000 0000"
                />
                <label for="nome-cartao">Nome impresso no cartão</label>
                <input
                  type="text"
                  id="nome-cartao"
                  name="nomeCartao"
                  autocomplete="cc-name"
                  placeholder="Nome completo"
                />
                <div class="card-fields-inline">
                  <div>
                    <label for="validade-cartao">Validade</label>
                    <input
                      type="text"
                      id="validade-cartao"
                      name="validadeCartao"
                      placeholder="MM/AA"
                      inputmode="numeric"
                      autocomplete="cc-exp"
                    />
                  </div>
                  <div>
                    <label for="cvv-cartao">CVV</label>
                    <input
                      type="text"
                      id="cvv-cartao"
                      name="cvvCartao"
                      placeholder="123"
                      inputmode="numeric"
                      autocomplete="cc-csc"
                    />
                  </div>
                </div>
              </div>

              <label for="nome">Nome completo:</label>
              <input
                type="text"
                id="nome"
                name="nome"
                required
                autocomplete="name"
              />

              <label for="endereco">Endereço de entrega:</label>
              <input
                type="text"
                id="endereco"
                name="endereco"
                required
                autocomplete="street-address"
              />

              <button type="submit" class="btn-cta btn-primary">
                Confirmar pagamento
              </button>
            </form>
          </div>
        </section>
      </main>

      <footer class="site-footer">
        <div class="container">
          <p>
            &copy; <span id="ano"></span> Pepeu - Berserk. Todos os direitos
            reservados.
          </p>
        </div>
      </footer>

      <script>
        (function () {
          function getQueryParam(name) {
            return new URLSearchParams(window.location.search).get(name);
          }

          const produtoName = getQueryParam("produto") || "";
          let quantidadeParam = parseInt(getQueryParam("quantidade") || "1", 10);
          const tamanhoParam = getQueryParam("tamanho") || "M";

          if (isNaN(quantidadeParam) || quantidadeParam <= 0) {
            quantidadeParam = 1;
          }

          const products = {
            "Isagi Yoichi": {
              price: 129.9,
              img: "img/Isagi Yoichi.png",
              desc: "Homenagem a Isagi Yoichi — linhas dinâmicas que representam estratégia e garra do personagem.",
            },
            "Michael Kaiser": {
              price: 129.9,
              img: "img/Michael Kaiser.png",
              desc: "Homenagem a Michael Kaiser — estilo urbano com formas geométricas e contraste marcante.",
            },
            "Toji Fushiguro": {
              price: 129.9,
              img: "img/Toji.png",
              desc: "Tributo a Toji Fushiguro — traços sombrios e visual arrojado.",
            },
            "Satoru Gojo": {
              price: 129.9,
              img: "img/Satoru Gojo.png",
              desc: "Tributo a Satoru Gojo — visual impactante com detalhes elegantes.",
            },
            "Zaraki Kenpachi": {
              price: 129.9,
              img: "img/Zaraki Kenpachi.png",
              desc: "Tributo a Zaraki Kenpachi — traços agressivos e alto contraste.",
            },
            "Ichigo Kurosaki": {
              price: 129.9,
              img: "img/Ichigo Kurosaki.png",
              desc: "Estampa Ichigo Kurosaki — design noturno com elementos em neon.",
            },
            "Son Goku": {
              price: 129.9,
              img: "img/Son Goku.png",
              desc: "Estampa Son Goku — design noturno com elementos em neon.",
            },
            "Vegeta Ego": {
              price: 129.9,
              img: "img/Vegeta Ego.png",
              desc: "Estampa Vegeta Ego — design noturno com elementos em neon.",
            },
            "Midoriya Izuku": {
              price: 149.9,
              img: "img/Midoriya Izuku.png",
              desc: "Estampa Midoriya Izuku — design vibrante com energia e movimento.",
            },
            "Sung Ji Woo": {
              price: 129.9,
              img: "img/Sung Ji Woo.png",
              desc: "Estampa Sung Ji Woo — design moderno com elementos urbanos e estilo contemporâneo.",
            },
          };

          const fallbackProduct = {
            price: 0,
            img: "img/prod1.jpg",
            desc: "Descrição não disponível para este produto.",
          };

          const productInfo = products[produtoName] || fallbackProduct;
          const price = productInfo.price;

          const produtoImgEl = document.getElementById("produto-img");
          const produtoNomeResumoEl = document.getElementById(
            "produto-nome-resumo"
          );
          const produtoDescResumoEl = document.getElementById(
            "produto-desc-resumo"
          );
          const resumoTamanhoEl = document.getElementById("resumo-tamanho");
          const resumoQuantidadeEl = document.getElementById("resumo-quantidade");
          const resumoTotalEl = document.getElementById("resumo-total");
          const resumoPagamentoEl = document.getElementById("resumo-pagamento");
          const produtoField = document.getElementById("produto");
          const tamanhoSelect = document.getElementById("tamanhoSelect");
          const quantidadeInput = document.getElementById("quantidadeInput");
          const anoEl = document.getElementById("ano");
          const formEl = document.getElementById("payForm");
          const paymentRadios = document.querySelectorAll(
            'input[name="formaPagamento"]'
          );
          const cardFields = document.getElementById("card-fields");
          const cardNumberInput = document.getElementById("numero-cartao");
          const cardNameInput = document.getElementById("nome-cartao");
          const cardExpiryInput = document.getElementById("validade-cartao");
          const cardCvvInput = document.getElementById("cvv-cartao");
          const feedbackEl = document.getElementById("feedback");

          let totalNumber = 0;

          if (produtoImgEl) {
            produtoImgEl.src = productInfo.img;
            produtoImgEl.alt = produtoName || "Produto selecionado";
          }
          if (produtoNomeResumoEl) {
            produtoNomeResumoEl.textContent = produtoName || "Produto";
          }
          if (produtoDescResumoEl) {
            produtoDescResumoEl.textContent = productInfo.desc;
          }

          if (produtoField) {
            produtoField.value = produtoName;
          }

          if (tamanhoSelect) {
            const allowedSizes = ["P", "M", "G", "GG"];
            if (allowedSizes.includes(tamanhoParam)) {
              tamanhoSelect.value = tamanhoParam;
            } else {
              tamanhoSelect.value = "M";
            }
          }

          if (quantidadeInput) {
            quantidadeInput.value = String(quantidadeParam);
          }

          function updateResumo() {
            let qtd = parseInt(quantidadeInput.value, 10);
            if (isNaN(qtd) || qtd <= 0) {
              qtd = 1;
              quantidadeInput.value = "1";
            }

            const tam = tamanhoSelect.value || "M";
            totalNumber = price * qtd;

            if (resumoTamanhoEl) resumoTamanhoEl.textContent = tam;
            if (resumoQuantidadeEl) resumoQuantidadeEl.textContent = String(qtd);
            if (resumoTotalEl) {
              resumoTotalEl.textContent =
                "R$ " + totalNumber.toFixed(2).replace(".", ",");
            }

            // Mostrar feedback
            if (feedbackEl) {
              feedbackEl.style.display = "block";
              setTimeout(() => {
                feedbackEl.style.display = "none";
              }, 2000); // Oculta após 2 segundos
            }
          }

          function toggleCardFields(selected) {
            if (!cardFields) return;
            const isCard = selected === "Cartão de crédito";

            cardFields.style.display = isCard ? "block" : "none";

            [
              cardNumberInput,
              cardNameInput,
              cardExpiryInput,
              cardCvvInput,
            ].forEach((input) => {
              if (!input) return;
              input.required = isCard;
            });
          }

          function updatePaymentStyles() {
            document.querySelectorAll(".payment-method").forEach((label) => {
              const input = label.querySelector('input[type="radio"]');
              if (input && input.checked) {
                label.classList.add("selected");
              } else {
                label.classList.remove("selected");
              }
            });
          }

          function updatePagamentoResumo() {
            let selected = "Pix";
            paymentRadios.forEach((radio) => {
              if (radio.checked) {
                selected = radio.value;
              }
            });

            if (resumoPagamentoEl) {
              resumoPagamentoEl.textContent = selected;
            }

            toggleCardFields(selected);
            updatePaymentStyles();
          }

          if (tamanhoSelect) {
            tamanhoSelect.addEventListener("change", updateResumo);
          }
          if (quantidadeInput) {
            quantidadeInput.addEventListener("input", updateResumo);
          }
          paymentRadios.forEach((radio) => {
            radio.addEventListener("change", updatePagamentoResumo);
          });

          updateResumo(); // primeira atualização
          updatePagamentoResumo(); // forma de pagamento inicial

          if (anoEl) {
            anoEl.textContent = new Date().getFullYear();
          }

          if (formEl) {
            formEl.addEventListener("submit", function (e) {
              e.preventDefault();

              const orderId =
                "PED" +
                String(Math.floor(Math.random() * 1_000_000)).padStart(6, "0");

              const params = new URLSearchParams(new FormData(formEl));
              params.append("total", totalNumber.toFixed(2)); // formato 0.00
              params.append("orderId", orderId);

              window.location.href = "obrigado.html?" + params.toString();
            });
          }
        })();
      </script>
    </body>
  </html>
